<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>관리자용 QnA 및 유저 목록</title>
    <link rel="stylesheet" type="text/css" th:href="@{/css/adminMain.css}">
</head>
<body>
<form th:action="@{/admin/logout}" method="post" style="display:inline;">
    <button type="submit" class="btn btn-secondary">로그아웃</button>
</form>
<div class="admin-chat-list-container">
    <!-- 왼쪽: 포스트 관리 -->
    <div class="post-management">
        <h1>게시글 관리</h1>

        <!-- 게시글 목록 -->
        <div class="table-wrapper">
            <table class="post-table">
                <thead>
                <tr>
                    <th>번호</th>
                    <th>제목</th>
                    <th>작성자</th>
                    <th>작성일</th>
                    <th>Actions</th>
                </tr>
                </thead>
                <tbody>
                <tr th:each="post, stat : ${posts.content}" th:class="${stat.index % 2 == 0} ? 'even' : 'odd'">
                    <td th:text="${post.pSeq}">번호</td>
                    <td>
                        <a th:href="@{/admin/posts/detail/{id}(id=${post.pSeq})}" th:text="${post.title}">제목</a>
                    </td>
                    <td th:text="${post.user.userId}">작성자</td>
                    <td th:text="${#temporals.format(post.postdate, 'yyyy-MM-dd HH:mm')}">작성일</td>
                    <td>
                        <form th:action="@{/admin/posts/delete/{id}(id=${post.pSeq})}" method="post">
                            <button type="submit" class="btn btn-danger btn-sm"
                                    onclick="return confirm('정말로 삭제하시겠습니까?');">삭제</button>
                        </form>
                    </td>
                </tr>
                <!-- 비어있는 행을 출력 -->
                <tr th:each="i : ${#numbers.sequence(posts.size, 15 - posts.size)}" class="empty-row">
                    <td colspan="5">-</td>
                </tr>
                </tbody>
            </table>
        </div>

        <!-- 글쓰기 및 페이징 버튼 -->
        <div class="post-actions">
            <div class="write-post">
                <a th:href="@{/admin/posts/write}" class="btn btn-primary">글쓰기</a>
            </div>
            <div class="pagination-container">
                <ul class="pagination">
                    <li class="page-item" th:classappend="${posts != null and posts.hasPrevious()} ? '' : 'disabled'">
                        <a class="page-link" th:href="@{/admin/posts(page=${posts.number - 1}, size=${posts.size})}" tabindex="-1">이전</a>
                    </li>
                    <li class="page-item" th:each="i : ${#numbers.sequence(0, posts.totalPages - 1)}" th:classappend="${i == posts.number} ? 'active' : ''">
                        <a class="page-link" th:href="@{/admin/posts(page=${i}, size=${posts.size})}" th:text="${i + 1}">1</a>
                    </li>
                    <li class="page-item" th:classappend="${posts != null and posts.hasNext()} ? '' : 'disabled'">
                        <a class="page-link" th:href="@{/admin/posts(page=${posts.number + 1}, size=${posts.size})}">다음</a>
                    </li>
                </ul>
            </div>
        </div>
    </div>



    <!-- 오른쪽: QnA와 유저 관리 -->
    <div class="QnA-user-container">
        <!-- 상단: QnA 관리 -->
        <div class="QnA-management">
            <h1>QnA 목록</h1>
            <div th:if="${#lists.isEmpty(userQnaList)}">
                <p>현재 QnA가 없습니다.</p>
            </div>
            <div th:each="userDto : ${userQnaList}" class="chat-room-item">
                <a th:href="@{/admin/qna/chat/{userId}(userId=${userDto.userId})}">
                    <div class="user-info">
                        <span class="user-name" th:text="${userDto.userName}">User Name</span>
                        <span class="last-question-time"
                              th:text="${#temporals.format(userDto.lastQDate, 'yyyy-MM-dd HH:mm')}">
                              마지막 질문 시간
                        </span>
                    </div>
                    <div class="last-message-preview">
                        <span th:text="${userDto.lastQuestion}">마지막 질문 내용</span>
                    </div>
                </a>
            </div>
        </div>

        <div class="user-management">
            <h1>유저 목록</h1>
            <div th:if="${allUser.empty}">
                <p>등록된 유저가 없습니다.</p>
            </div>
            <table th:if="${!allUser.empty}" class="user-table">
                <thead>
                <tr>
                    <th>유저 ID</th>
                    <th>유저 이름</th>
                    <th>이메일</th>
                    <th>역할</th>
                    <th>가입일</th>
                    <th>Actions</th> <!-- 새로운 열 추가 -->
                </tr>
                </thead>
                <tbody>
                <tr th:each="user : ${allUser.content}">
                    <td th:text="${user.userId}" data-label="유저 ID">아이디</td>
                    <td th:text="${user.name}" data-label="유저 이름">이름</td>
                    <td th:text="${user.role}" data-label="역할">권한</td>
                    <td th:text="${#temporals.format(user.regdate, 'yyyy-MM-dd')}" data-label="가입일">가입일</td>
                    <td data-label="Actions">
                        <div class="action-buttons">
                            <a th:href="@{/admin/profile/{id}(id=${user.userId})}" class="btn btn-info btn-sm" role="button">세부정보</a>
                            <form th:action="@{/admin/delete/{id}(id=${user.userId})}" method="post" class="delete-form">
                                <button type="submit" class="btn btn-danger btn-sm"
                                        onclick="return confirm('정말로 삭제하시겠습니까?');">탈퇴
                                </button>
                            </form>
                        </div>
                    </td>
                </tr>
                </tbody>
            </table>

            <div class="pagination-container">
                <ul class="pagination">
                    <li class="page-item" th:classappend="${allUser != null and allUser.hasPrevious()} ? '' : 'disabled'">
                        <a class="page-link" th:href="@{/admin/main(page=${allUser.number - 1}, size=${allUser.size})}"
                           tabindex="-1">이전</a>
                    </li>
                    <li class="page-item" th:each="i : ${#numbers.sequence(0, allUser.totalPages - 1)}"
                        th:classappend="${i == allUser.number} ? 'active' : ''">
                        <a class="page-link" th:href="@{/admin/main(page=${i}, size=${allUser.size})}"
                           th:text="${i + 1}">1</a>
                    </li>
                    <li class="page-item" th:classappend="${allUser != null and allUser.hasNext()} ? '' : 'disabled'">
                        <a class="page-link" th:href="@{/admin/main(page=${allUser.number + 1}, size=${allUser.size})}">다음</a>
                    </li>
                </ul>
            </div>
        </div>
    </div>
</div>
</body>
</html>
